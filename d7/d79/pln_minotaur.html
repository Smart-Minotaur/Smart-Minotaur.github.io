<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Smart Minotaur: pln_minotaur</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../logo_small.jpg"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Smart Minotaur
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Erzeugt von Doxygen 1.8.1.2 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Suchen');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Hauptseite</span></a></li>
      <li class="current"><a href="../../pages.html"><span>Zusätzliche&#160;Informationen</span></a></li>
      <li><a href="../../annotated.html"><span>Klassen</span></a></li>
      <li><a href="../../files.html"><span>Dateien</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Suchen" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('d7/d79/pln_minotaur.html','../../');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>Alle</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Klassen</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Dateien</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Funktionen</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variablen</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Seiten</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">pln_minotaur </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Inhaltsverzeichnis</h3>
<ul><li class="level1"><a href="#description">Beschreibung</a></li>
<li class="level1"><a href="#compile">Kompilieren</a><ul><li class="level2"><a href="#arm">ARM</a></li>
<li class="level2"><a href="#x86">x86</a></li>
</ul>
</li>
<li class="level1"><a href="#api-implementation">API und Implementierung</a><ul><li class="level2"><a href="#classes">Klassen</a><ul><li class="level3"><a href="#spidevice">SPIDevice.h</a></li>
<li class="level3"><a href="#PLN2033">PLN2033.h</a></li>
</ul>
</li>
<li class="level2"><a href="#config">Optimale Einstellungen</a></li>
<li class="level2"><a href="#API">API</a></li>
<li class="level2"><a href="#array-converter">Array-Converter</a></li>
</ul>
</li>
<li class="level1"><a href="#example">Beispiele</a></li>
<li class="level1"><a href="#improvements">Verbesserungen</a></li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="description"></a>
Beschreibung</h1>
<p>pln_minotaur ist eine C++ Bibliothek zum Ansteuern der PLN2033 Maussensoren. Durch das Benutzen dieser Bibliothek wird vom Benutzer keine genaue Kenntnis über das Linux SPI Interface sowie den PLN2033 Sensor benötigt. Das pln_minotaur::IPLNTrackingDevice Interface stellt Funktionen zum Abfragen der Entfernungs-Werte sowie Geschwindigkeits-Werte zur Verfügung. Zusätzlich können die Sensoreinstellungen abgefragt sowie die Auflösung des Sensors gesetzt werden. Durch die hohe Flexibilität und Skalierbarkeit der Bibliothek kann eine beliebige Anzahl von Sensoren angeschlossen werden. Der Benutzer benötigt lediglich den Namen des spidev device files.</p>
<p>pln_2033 bietet folgende Features:</p>
<ul>
<li>Viele verschiedene Funktionen zum Abfragen der Sensor Daten für verschiedene Anwendungsfälle</li>
<li>Abfrage von Displacement sowie Speed Werten des Sensors</li>
<li>Abfragen und Setzen verschiedener SPI Einstellungen</li>
<li>Abfragen von Sensor Einstellungen und Sensor Status (Alle Sensor Register)</li>
<li>Sehr abstrahiert vom Linux SPI Interface</li>
<li>Setzen von X- und Y-Auflösung eines Sensors</li>
<li>Einfache objektorientierte Benutzung</li>
<li>Keine externen Bibliotheken werden benötigt (benutzt Linux spidev Treiber)</li>
<li>Verfügbar für ARM sowie x86 Architekturen</li>
</ul>
<p>Die API sowie Details über die Implementierung/Vererbungshierarchie sind auf den Doxygen Seiten der pln_minotaur Bibliothek verfügbar. Die Erklärung der Konfiguration des SPI Interfaces befindet sich auf der Maussensoren Seite.</p>
<h1><a class="anchor" id="compile"></a>
Kompilieren</h1>
<p>Als Buildtool wird CMake verwendet. Die pln_minotaur Bibliothek wird für das BBB cross-compiliert. Zum Kompilieren wird ein C++11 fähiger Compiler benötigt. Der bei der Erstellung der Bibliothek verwendete Compiler ist der GCC 4.8. Die Bibliothek kann für ARM sowie x86 Architekturen kompiliert werden. Im Projektverzeichnis ist jeweils eine statisch kompilierte ARM sowie x86 Version der Bibliothek verfügbar. Um pln_minotaur selbst zu kompilieren müssen für die Architektur passende toolchain files verwendet werden. In den toolchain files müssen die verwendeten ARM oder x86 Compiler eingetragen sein. Folgende Befehle werden ausgeführt um die Bibliotheken sowie ein Beispiel zu erstellen. Die erzeugten Dateien befinden sich im Ordner build.</p>
<h2><a class="anchor" id="arm"></a>
ARM</h2>
<pre class="fragment">mkdir build
cd build
cmake -DCMAKE_TOOLCHAIN_FILE=../toolchain-BeagleBoneBlack.cmake ..
make
</pre><h2><a class="anchor" id="x86"></a>
x86</h2>
<pre class="fragment">mkdir build
cd build
cmake -DCMAKE_TOOLCHAIN_FILE=../toolchain-x86-BeagleBoneBlack.cmake ..
make
</pre><h1><a class="anchor" id="api-implementation"></a>
API und Implementierung</h1>
<h2><a class="anchor" id="classes"></a>
Klassen</h2>
<p>Um pln_minotaur zu verwenden wird nur das Interface pln_minotaur::IPLNTrackingDevice benötigt. Methoden zum Auslesen von</p>
<ul>
<li>Displacement in CPI (counts per inch)</li>
<li>Displacement in cm</li>
<li>Displacement (in CPI oder cm) mit Zeitstempel</li>
<li>Speed in cm/second sind vorhanden.</li>
</ul>
<p>Bei jedem Lesen der Displacement-Werte, wird zusätzlich ein Zeitstempel mit abgespeichert. Dadurch kann die Geschwindigkeit des Sensors berechnet werden. Über das Interface können zusätzlich die aktuellen Sensor-Einstellungen ausgelesen werden. Auch ist das Setzen der X- und Y-Auflösung möglich.</p>
<p>Hauptbestandteil sind die Klassen pln_minotaur::PLN2033 sowie pln_minotaur:: SPIDevice. Im folgenden werden die Funktionen der verschiedenen Klassen zusammengefasst:</p>
<div class="image">
<img src="../../pln2033_interface.png" alt="pln2033_interface.png"/>
<div class="caption">
PLN2033 Interfaces</div></div>
 <h3><a class="anchor" id="spidevice"></a>
SPIDevice.h</h3>
<p>Wrapper-Klasse für den Linux SPI Treiber. Bietet komfortablere Funktionen für den Zugriff auf den SPI-Bus.</p>
<ul>
<li>Senden und Empfangen von Daten über SPI</li>
<li>Setzen verschiedener SPI Konfigurationen</li>
</ul>
<h3><a class="anchor" id="PLN2033"></a>
PLN2033.h</h3>
<p>Implementiert das SPI Bus Protokoll des PLN2033 Sensors.</p>
<ul>
<li>Sensorregister schreiben und lesen</li>
<li>RAM schreiben und lesen</li>
<li>RAM Code laden</li>
<li>RAM Code überprüfen</li>
<li>Sensor initialisieren (Initial Configuration Procedur durchführen)</li>
<li>Power on</li>
<li>Power down</li>
<li>Soft reset</li>
</ul>
<h2><a class="anchor" id="config"></a>
Optimale Einstellungen</h2>
<p>SPI: </p>
<pre class="fragment">const int SPIDevice::DEFAULT_SPI_MODE = 1;
const int SPIDevice::DEFAULT_SPI_SB = 0;
const int SPIDevice::DEFAULT_SPI_BITS = 8;
const int SPIDevice::DEFAULT_SPI_SPEED = 3000000;
</pre><p>Optimale sample Rate zum Abfragen der Displacement Register: 1kHz (1ms Interval).</p>
<p>(Siehe Datenblatt des PLN2033 Sensors für mögliche sample rates)</p>
<h2><a class="anchor" id="API"></a>
API</h2>
<p>Nach dem Aufruf einer read* Funktion wird das Read Register Kommando über SPI an den Sensor gesendet. Jedes read Displacement Kommando wird intern mit einem Zeitstempel versehen. Nach jedem Lesen werden die Displacement Register (X und Y) auf 0 zurückgesetzt. Um die Sensor Einstellungen abzufragen wird pln_minotaur::IPLNTrackingDevice::readPLNSettings() verwendet. Diese Funktion liefert ein Objekt der Klasse PLNSettings zurück und beschreibt die gesamte Sensorkonfiguration. Diese besteht aus allen internen Registerwerten. Zum Abfragen des Status-Registers steht die Funktion pln_minotaur::IPLNTrackingDevice::readPLNStatusRegister() zu Verfügung. Beim Auslesen des Statusregisters werden ebenfalls die Displacement-Register zurück gesetzt.</p>
<p>ACHTUNG: Wichtig zu wissen ist, wann die internen Zähler/Register des Sensors zurückgesetzt werden. Werden Displacement-Werte oder das Status-Register gelesen, werden die Displacement-Register auf 0 zurückgesetzt. Auch werden diese zurückgesetzt, wenn das Lift-Bit aktiviert wird (also wenn der Sensor zu weit von der Oberfläche entfernt ist).</p>
<h2><a class="anchor" id="array-converter"></a>
Array-Converter</h2>
<p>Um den Philips PLN2033 zu benutzen, muss zuerst ein Patch Code ins RAM des DSP geladen werden. Das kleine Utility-Programm arrayConverter konvertiert den vorhandenen Patch Code in eine korrektes Format (Hex-Darstellung) um diesen komfortabel beim Start der Bibliothek ins RAM laden zu können. Der Patch Code wird im uint8 Array Format und in korrekter Endian-Darstellung in eine Datei abgespeichert.</p>
<h1><a class="anchor" id="example"></a>
Beispiele</h1>
<p>Beispiele zur Benutzung der pln_minotaur Bibliothek befinden sich in der Doxygen Dokumentation der pln_minotaur Bibliothek.</p>
<h1><a class="anchor" id="improvements"></a>
Verbesserungen</h1>
<p>pln_2033 unterstützt nicht alle Funktionen des PLN2033. Eine Verbesserung der Bibliothek wäre das Hinzufügen von Möglichkeiten zum konfigurieren verschiedener Sleep-States des Sensors. Zusätzlich könnte die Möglichkeiten zum Ansteuern des Sensors über Interrupts implementiert werden. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../index.html">Smart Minotaur</a></li><li class="navelem"><a class="el" href="../../da/df2/maussensoren.html">Maussensoren</a></li>
    <li class="footer">Erzeugt am Mon Sep 29 2014 14:43:12 für Smart Minotaur von
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.8.1.2 </li>
  </ul>
</div>
</body>
</html>
