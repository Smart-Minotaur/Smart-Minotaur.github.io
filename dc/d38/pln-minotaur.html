<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Smart Minotaur: pln_minotaur</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../logo_small.jpg"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Smart Minotaur
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Erzeugt von Doxygen 1.8.1.2 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Suchen');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Hauptseite</span></a></li>
      <li class="current"><a href="../../pages.html"><span>Zusätzliche&#160;Informationen</span></a></li>
      <li><a href="../../annotated.html"><span>Klassen</span></a></li>
      <li><a href="../../files.html"><span>Dateien</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Suchen" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('dc/d38/pln-minotaur.html','../../');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>Alle</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Klassen</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Dateien</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Funktionen</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Seiten</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">pln_minotaur </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Bisher wird für die Odometrie des Roboters lediglich die Motoren verwendet. Diese bieten jedoch eine sehr geringe Genauigkeit und Zuverlässigkeit. Zusätzlich kann sich dies je nach Fahrfläche verschlimmern (Räder drehen durch). Um die Odometrie zu verbessern werden im Smart-Minotaur zusätzlich Maussensoren von herkömmlichen Gaming-Computermäusen verwendet. Die in diesem Projekt verwendete Sensoren sind die Philips pln2033 twin-eye laser sensoren. Diese verfügen über eine sehr hohe Präzision (bis zu 6400 CPI - Counts Per Inch) beim Messen der zurückgelegten X- und Y-Distanzwerte.</p>
<h1><a class="anchor" id="pln2033"></a>
PLN2033 Sensor</h1>
<p>In diesem Abschnitt werden die wichtigsren Funktionen des pln2033 Sensors erläutert. Weitere Informationen befinden sich im Datenblatt: TODO.</p>
<p>Der pln2033 besitzt unterschiedliche 16-Bit Register mit welchen dieser gesteuert werden kann. Es werden zwei Laser verwendet, um die X und Y positions änderungen zu messen. Intern verarbeitet ein DSP die gemessen Daten. Die Auflösung kann von 100 bis 6400 CPI eingestellt werden. Die Ansteuerung des Sensors erflgt über SPI und kann mit bis zu 8Mhz betrieben werden. Der pln2033 benötigt 3.3V.</p>
<h1><a class="anchor" id="hardware-setup"></a>
Hardware Setup</h1>
<p>Gelötete Platine Bild</p>
<p>TODO: Bild mit SPI</p>
<h1><a class="anchor" id="spi-device-tree"></a>
Linux SPI treiber und Device Tree</h1>
<p>Zum Ansteuern des pln2033 wird der SPI-Bus verwendet. Für das Smart-Minotaur Projekt wurden zwei Sensoren an den Roboter montiert (Nur einer wird benötigt, um Position und Ausrichtung zu bestimmen). Da zum Ansteuern von zwei Slaves auf dem SPI Bus zwei Chip sleects benötigt werden wird der SPI1 Port des Beagle Bones verwendet. Um daten zu senden und Emopfangen wird der linux spidev treiber verwendet, welcher rudimentöre Funktionen anbietet. Um SPI1 Port benutzzen zu können muss dieser erst im Device Tree registreirt werden. Dafür wird eine device teree source file benötigt, welche die korrekten Pins, register und funktionaklittäten des SPUI Gerätes spezifiert. Diese Datei wird kompiliert und im Linux kernel aktiviert. Wichtig ist, HDMI des BBB auszuschalten, da dieses auch SPI1 Ports verwendet und die kommukiation stören wütrde. Nach erfolgreicher aktivierung kann auf die slaves über gerätedateien zugegriffen werden:</p>
<p>/dev/spidev1.0 CS0 /dev/spidev1.1 CS1</p>
<h1><a class="anchor" id="pln_minotaur"></a>
pln_minotaur library</h1>
<p>Die pln_minotaur Bibliothek wird zum ansteuern der pln2033 Maussensoren verwendet. Dadurch wird vom Benutzer keine genaue Kenntnis über das Linux SPI interface sowie den pln2033 Sensor benötigt. Das pln_minotaur::IPLNTrackingDevice interface stellt functionen zum Abfragen der Entfernungs-Werte sowie Geschwindigkeits-Werte zu verfügung. <hr/>
 After one of these functions is called, the read command (required register data) is sent to the sensor. Every read command is internally marked with a timestamp. After each read, the displacement values are set to 0. </p>
<h1>To get the status of the sensor, the pln_minotaur::IPLNTrackingDevice::readPLNSettings() function can be used. This class consists of the whole sensor configuration data and provides some functions to extract the most interesting data.</h1>
<p>ACHTUNG: Wichtig zu wissen ist, wann die internen Zähler/Register des sensors zurückgesetzt werden. Werdern displacement werde oder das status register gleesne, werden die dispalcement register auf 0 zurückgesetzt. Auch werden diese zurückgestezt, wenn das Lift-Bit aktiviert wird (also wenn der sensor zu weit von der oberfläche entfenrt wis).</p>
<h2><a class="anchor" id="make"></a>
Kompilierung</h2>
<p>Als make system wird cmake verwendet. Die pln_minotaur Bibliothek wird für das BBB cross-compiliert. Die installation eines cross compilers ist in TODO beschrieben. Eine toolchain file wird benötigt, um den verwendeten cross-compiler zu bestimmen. da zusätzlichj datenstrukturen der pln_minotaur bibliothek auf dem Desktop-PC verwnedet werden kann auch eine x86 version der bibliothek erstekll wer5den. im buiild verzeichnis finden sich beider versionen der bibliothek.</p>
<h1><a class="anchor" id="example"></a>
Beispiele</h1>
<p>Beispiele zur Benutzung der pln_minotaur Bibliotheke befinden sich auf folgender Seite: TODO</p>
<h1><a class="anchor" id="mouse-monitor"></a>
Mouse Monitor (mouse_monitor_pc package)</h1>
<p>Mouse Monitor wurde ursprünglich zum testen der Philips pln2033 Maussensoren entwickelt. Die Anwendung verfügt üpber eine Vielzahl von Funktionen und ist in zwei teile untergliedert. Zur kommunikation über WLAN wird das ROS message systrem verwendet.</p>
<p>TODO BIld</p>
<p>Beagle Bone Node Diese Anwendung ist für das Auslesen der Maussdnesopr displacement und speed daten zustäöndig und verwendet dafür die pln_minotaur bibliothek. Daten werden mit einer 1kHz freqwuenz ausgelesne und aufsummiert. Auf anfrage der PC Node sendet die Aplikation die geasmmeltebn daten zur PC Node. Zusätlich bietet diese funktionen um von extern die auflösung (CPI) der sensoren zu setzen sowie zum abgragen des sattus der sensoren.</p>
<p>PC Node Die PC Node empfäng die Snesore daten, verarbeitet diese und dstellt sie grafisch dar. Über diese Anwendung kann die CPI auflösung der sneoren eingestellt werden. zusätzlich kann eine variable sampel rate der GUI konfiguuirtioert werden (meist 15-100Hz). Im folgenden werden einige Features Der Anwendugn erklärt:</p>
<p>TODO</p>
<p>TODO: Bild</p>
<h1><a class="anchor" id="kalibrierung"></a>
kalibrierung</h1>
<h1><a class="anchor" id="localization"></a>
Berechnung der Position und Ausrichtung des Roboters</h1>
<p>Zum bestimmen der Position und der Ausrichtung des Roboters wird nur 1 Sensor benötigt. Die Berechnung der Roboter Porsition sowie Ausrichtung wird in deisem Abschnit beschrieben.</p>
<h1><a class="anchor" id="problems"></a>
Probleme</h1>
<p>Während der Durchführung des Projektes traten einige Probleme bezüglcih der pln2033 Sensore auf. Diese werden in diesem Abschnitt erläutert.</p>
<ul>
<li>Schwierige Fehlersuche sowie Validierung der Funktionalität aufgrund schlechter Testumgebung und schlechtem hardware-Aufbau.</li>
</ul>
<p>Der pln2033 ist ein hochprezisieser lasersensor. Um korrkete Aussagen über seine Funktionsweise zu machen, ist ein professioneller Prüfstand erforderlich welcher in diesem Projetkl nicht vorhanden war. Die tests mussten per hand (Lego-Wagen per Hand schieben, drehen ...) durchgeführt werrden, was genaues meessen unmöglich machte. Eine exakte geradweausfahrt, dreghung, .. konnte damit nicht erreicht werden.</p>
<p>Zum testen sowie bei der endmmontierung auf dem Roboter wird Lego benutzt, was wiederrum einige Probleme mit sich fühert:</p>
<ul>
<li>Wackelnde montage: Bei Bewegung des Roboters wackeln die sensoren.</li>
<li>Sensoren sins sehr empfindlich. Mit Lego können diese nicht in einer exakten höhe montiert erden (was das Lift-Bit auslöst, dazu später mehr).</li>
<li>Eine geraqde Montierung der sensoren ist nicht möglich.</li>
</ul>
<ul>
<li>Lift-Bit problem</li>
<li>Median Filter problerm</li>
<li>WLAN Latenz</li>
</ul>
<h1><a class="anchor" id="improvement"></a>
Verbesserungen</h1>
<h1><a class="anchor" id="api-implementation"></a>
API sowie Implementierung</h1>
<h2><a class="anchor" id="array-converter"></a>
Array-Converter</h2>
<p>Um den Philips pln2033 zu benutzen muss zuerst ein Patch code ins RAM des DSP geladen werden. Das kleine utility programm arrayConverter convertiert den vorhandenen Pacth code in eine korrektes Format (Hex darstellung) um diesen komfortabel beim start der bibliothek ins RAM laden zu können. Der Patch code wird im uint8 array format und in korrekte endian darstellung in einer datei sgespeichert.</p>
<p>Um pln_minotaur zu vwernwenden wird nur das interace IPLNTrackingDevice benötigt.methoden zum auslesen von</p>
<ul>
<li>Displacement in CPI (counts per inch)</li>
<li>Displacement in cm</li>
<li>Speed in cm/second sind vorhanden.</li>
</ul>
<p>Bei jedem Lesen der dISplacement werte, ird zusätzlich ein zeitstwemple mit agespeichert. Dadurch kann die geschwidigkeit des sebnsores berechent werden. Über das Interface kann zusätzlich die aie aktuellen sensor einstellungen ausgelesen werden. Auch ist dsaqs setzten der X und y auflösung möglich.</p>
<p>Im folgenden werden die Funktionen der verschiedenen klassen zusammengedfasst:</p>
<p>PLN2033.h: Sensior register schreiben und lesen RAM schreiben und lesen RAM code laden RAM code überprüfen Snesor initalsieren (inital configuration procedur durchführen) power on poer down soft reset</p>
<p>SPIDevice.h: Wrapper klasse für den Linux SPI trieber: Senden und empfangen von daten über SPI Settzen verschiedner SPI configtatuinenn</p>
<p>Zusätzlich: SPIException und LN2033_Settings und PatchCode8</p>
<p>Die API sowie details über die Implementierung/Vererbungshierachie sind auf folgenden Seiten verfügbar: TODO Link </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../index.html">Smart Minotaur</a></li><li class="navelem"><a class="el" href="../../d1/d5b/vorarbeit.html">Vorarbeit</a></li>
    <li class="footer">Erzeugt am Mon Sep 15 2014 14:35:40 für Smart Minotaur von
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.8.1.2 </li>
  </ul>
</div>
</body>
</html>
